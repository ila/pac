
for the microbenchmarks, get the following instances on EC2:
- i8gd.4xlarge 16xGraviton4 2.7GHz, 32GB RAm, 950GB SSD
- c8i.4xlarge 16xGranite Rapids 3.9GHz,32GB RAM, EBS: choose 90GB io2
- c8a.4xlarge 16xEPYC 9R45 4.5GHz, 32GB RAM, EBS: choose 90GB io2

choose Ubuntu 24 as the OS (ssh ubuntu@public-ip -i yourkey.pem into it)

inside the boxes:

# only for graviton i8gd instance -- install a filesystem on its ssd
sudo parted /dev/nvme0n1 -- mklabel gpt
sudo parted /dev/nvme0n1 -- mkpart primary ext4 0% 200GB
sudo mkfs.ext4 /dev/nvme0n1p1
sudo mkdir -p /mnt/instance-store
sudo mount /dev/nvme0n1p1 /mnt/instance-store
cd /mnt/instance-store/
chmod 777 .

sudo apt update
sudo apt install -y clang cmake ninja-build python3
export CC=clang
export CXX=clang++
git clone --depth 1 https://github.com/llvm/llvm-project.git
cd llvm-project
cmake -S llvm -B build -G Ninja \
    -DCMAKE_BUILD_TYPE=Release \
    -DLLVM_ENABLE_PROJECTS="clang;lld" \
    -DLLVM_TARGETS_TO_BUILD="X86" or "AArch64"
ninja -C build clang lld
cd ..
git clone --recurse-submodules https://github.com/ila/pac.git
cd pac/benchmark/pac_microbench
./build_variants.sh
./create_test_db.sh 
nohup ./run_all.sh&
# the results will be in csv files in the results/dir

# experiments will cost +-6 hourse, so rental cost per machine is around $3

# scripts on the result files (need to edit the filenames inside these):
benchmark/pac_microbench/plot_simd_improvements.py
benchmark/pac_microbench/plot_count_optimizations.py	
benchmark/pac_microbench/plot_minmax_optimizations.py	
benchmark/pac_microbench/plot_sum_optimizations.py

# stability of PAC_SUM() on various distributions 
# after running build_variants.sh (see above) on any 
# platform you would have duckdb_default and duckdb_exactsum
benchmark/pac_microbench/approx_sum_stability.sql

# uniform randomness of murmur hash
benchmark/pac_microbench/bionmial.sq 
# generates output for:
benchmark/pac_microbench/plot_hash_distribution.py	
